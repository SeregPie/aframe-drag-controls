!function(e){"use strict";let{THREE:t}=e,{EventDispatcher:n,Matrix4:r,Plane:o,Raycaster:i,Vector2:a,Vector3:s}=t;var c=function(e,t,n){var c=new o,l=new i,d=new a,p=new s,u=new s,v=new s,h=new r,m=[],y=null,g=null,f=this;function b(){n.addEventListener("pointermove",j,!1),n.addEventListener("pointerdown",L,!1),n.addEventListener("pointerup",w,!1),n.addEventListener("pointerleave",w,!1),n.addEventListener("touchmove",x,!1),n.addEventListener("touchstart",F,!1),n.addEventListener("touchend",C,!1)}function E(){n.removeEventListener("pointermove",j,!1),n.removeEventListener("pointerdown",L,!1),n.removeEventListener("pointerup",w,!1),n.removeEventListener("pointerleave",w,!1),n.removeEventListener("touchmove",x,!1),n.removeEventListener("touchstart",F,!1),n.removeEventListener("touchend",C,!1),n.style.cursor=""}function j(r){switch(r.pointerType){case"mouse":case"pen":!function(r){var o=n.getBoundingClientRect();if(d.x=(r.clientX-o.left)/o.width*2-1,d.y=-(r.clientY-o.top)/o.height*2+1,l.setFromCamera(d,t),y&&f.enabled)return r.preventDefault(),l.ray.intersectPlane(c,u)&&y.position.copy(u.sub(p).applyMatrix4(h)),void f.dispatchEvent({type:"drag",object:y});if(m.length=0,l.setFromCamera(d,t),l.intersectObjects(e,!0,m),m.length>0){var i=m[0].object;c.setFromNormalAndCoplanarPoint(t.getWorldDirection(c.normal),v.setFromMatrixPosition(i.matrixWorld)),g!==i&&(f.dispatchEvent({type:"hoveron",object:i}),n.style.cursor="pointer",g=i)}else null!==g&&(f.dispatchEvent({type:"hoveroff",object:g}),n.style.cursor="auto",g=null)}(r)}}function L(r){switch(r.pointerType){case"mouse":case"pen":m.length=0,l.setFromCamera(d,t),l.intersectObjects(e,!0,m),m.length>0&&(y=!0===f.transformGroup?e[0]:m[0].object,l.ray.intersectPlane(c,u)&&(h.copy(y.parent.matrixWorld).invert(),p.copy(u).sub(v.setFromMatrixPosition(y.matrixWorld))),n.style.cursor="move",f.dispatchEvent({type:"dragstart",object:y}))}}function w(e){switch(e.pointerType){case"mouse":case"pen":!function(e){y&&(e.preventDefault(),f.dispatchEvent({type:"dragend",object:y}),y=null);n.style.cursor=g?"pointer":"auto"}(e)}}function x(e){e=e.changedTouches[0];var r=n.getBoundingClientRect();if(d.x=(e.clientX-r.left)/r.width*2-1,d.y=-(e.clientY-r.top)/r.height*2+1,l.setFromCamera(d,t),y&&f.enabled)return e.preventDefault(),l.ray.intersectPlane(c,u)&&y.position.copy(u.sub(p).applyMatrix4(h)),void f.dispatchEvent({type:"drag",object:y})}function F(r){r=r.changedTouches[0];var o=n.getBoundingClientRect();d.x=(r.clientX-o.left)/o.width*2-1,d.y=-(r.clientY-o.top)/o.height*2+1,m.length=0,l.setFromCamera(d,t),l.intersectObjects(e,!0,m),m.length>0&&(y=!0===f.transformGroup?e[0]:m[0].object,c.setFromNormalAndCoplanarPoint(t.getWorldDirection(c.normal),v.setFromMatrixPosition(y.matrixWorld)),l.ray.intersectPlane(c,u)&&(h.copy(y.parent.matrixWorld).invert(),p.copy(u).sub(v.setFromMatrixPosition(y.matrixWorld))),n.style.cursor="move",f.dispatchEvent({type:"dragstart",object:y}))}function C(e){y&&(e.preventDefault(),f.dispatchEvent({type:"dragend",object:y}),y=null),n.style.cursor="auto"}b(),this.enabled=!0,this.transformGroup=!1,this.activate=b,this.deactivate=E,this.dispose=function(){E()},this.getObjects=function(){return e}};(c.prototype=Object.create(n.prototype)).constructor=c;let l="drag-controls";e.registerComponent(l,{schema:{enabled:{default:!0},objects:{default:"*"}},init(){let{el:e}=this,{camera:t,renderer:n}=e.sceneEl,r=new c([],t,n.domElement);r.addEventListener("dragstart",(()=>{e.emit(`${l}:changed`,{active:!0},!1)})),r.addEventListener("dragend",(()=>{e.emit(`${l}:changed`,{active:!1},!1)})),["dragstart","drag","dragend","hoveron","hoveroff"].forEach((e=>{r.addEventListener(e,(t=>{let{object:n}=t,r=n.el;r&&r.emit(e,{object3D:n},!1)}))})),Object.assign(this,{camera:t,controls:r})},update(){let{controls:e,data:t}=this,{enabled:n}=t;Object.assign(e,{enabled:n})},remove(){this.controls.dispose()},tock(){let{controls:e,data:t,el:n}=this,{enabled:r,objects:o}=t;if(r){let t=Array.from(n.sceneEl.querySelectorAll(o)),r=[];t.forEach((e=>{e.isEntity&&e.object3D&&r.push(e.object3D)})),e.getObjects().splice(0,void 0,...r)}}})}(AFRAME);
