!function(e){"use strict";let{THREE:t}=e,{EventDispatcher:n,Matrix4:r,Plane:o,Raycaster:i,Vector2:a,Vector3:s}=t;var c=function(e,t,n){var c=new o,l=new i,d=new a,p=new s,u=new s,v=new s,h=new r,m=[],b=null,g=null,y=this;function f(){n.addEventListener("pointermove",j,!1),n.addEventListener("pointerdown",w,!1),n.addEventListener("pointerup",L,!1),n.addEventListener("pointerleave",L,!1),n.addEventListener("touchmove",x,!1),n.addEventListener("touchstart",F,!1),n.addEventListener("touchend",O,!1)}function E(){n.removeEventListener("pointermove",j,!1),n.removeEventListener("pointerdown",w,!1),n.removeEventListener("pointerup",L,!1),n.removeEventListener("pointerleave",L,!1),n.removeEventListener("touchmove",x,!1),n.removeEventListener("touchstart",F,!1),n.removeEventListener("touchend",O,!1),n.style.cursor=""}function j(r){switch(r.pointerType){case"mouse":case"pen":!function(r){var o=n.getBoundingClientRect();if(d.x=(r.clientX-o.left)/o.width*2-1,d.y=-(r.clientY-o.top)/o.height*2+1,l.setFromCamera(d,t),b&&y.enabled)return r.preventDefault(),l.ray.intersectPlane(c,u)&&b.position.copy(u.sub(p).applyMatrix4(h)),void y.dispatchEvent({type:"drag",object:b});if(m.length=0,l.setFromCamera(d,t),l.intersectObjects(e,!0,m),m.length>0){var i=m[0].object;c.setFromNormalAndCoplanarPoint(t.getWorldDirection(c.normal),v.setFromMatrixPosition(i.matrixWorld)),g!==i&&(y.dispatchEvent({type:"hoveron",object:i}),n.style.cursor="pointer",g=i)}else null!==g&&(y.dispatchEvent({type:"hoveroff",object:g}),n.style.cursor="auto",g=null)}(r)}}function w(r){switch(r.pointerType){case"mouse":case"pen":m.length=0,l.setFromCamera(d,t),l.intersectObjects(e,!0,m),m.length>0&&(b=!0===y.transformGroup?e[0]:m[0].object,l.ray.intersectPlane(c,u)&&(h.copy(b.parent.matrixWorld).invert(),p.copy(u).sub(v.setFromMatrixPosition(b.matrixWorld))),n.style.cursor="move",y.dispatchEvent({type:"dragstart",object:b}))}}function L(e){switch(e.pointerType){case"mouse":case"pen":!function(e){b&&(e.preventDefault(),y.dispatchEvent({type:"dragend",object:b}),b=null);n.style.cursor=g?"pointer":"auto"}(e)}}function x(e){e=e.changedTouches[0];var r=n.getBoundingClientRect();if(d.x=(e.clientX-r.left)/r.width*2-1,d.y=-(e.clientY-r.top)/r.height*2+1,l.setFromCamera(d,t),b&&y.enabled)return e.preventDefault(),l.ray.intersectPlane(c,u)&&b.position.copy(u.sub(p).applyMatrix4(h)),void y.dispatchEvent({type:"drag",object:b})}function F(r){r=r.changedTouches[0];var o=n.getBoundingClientRect();d.x=(r.clientX-o.left)/o.width*2-1,d.y=-(r.clientY-o.top)/o.height*2+1,m.length=0,l.setFromCamera(d,t),l.intersectObjects(e,!0,m),m.length>0&&(b=!0===y.transformGroup?e[0]:m[0].object,c.setFromNormalAndCoplanarPoint(t.getWorldDirection(c.normal),v.setFromMatrixPosition(b.matrixWorld)),l.ray.intersectPlane(c,u)&&(h.copy(b.parent.matrixWorld).invert(),p.copy(u).sub(v.setFromMatrixPosition(b.matrixWorld))),n.style.cursor="move",y.dispatchEvent({type:"dragstart",object:b}))}function O(e){b&&(e.preventDefault(),y.dispatchEvent({type:"dragend",object:b}),b=null),n.style.cursor="auto"}f(),this.enabled=!0,this.transformGroup=!1,this.activate=f,this.deactivate=E,this.dispose=function(){E()},this.getObjects=function(){return e}};(c.prototype=Object.create(n.prototype)).constructor=c;let l="drag-controls";e.registerComponent(l,{schema:{enabled:{default:!0},objects:{default:"*"}},init(){let{el:e}=this,{camera:t,renderer:n}=e.sceneEl,r=new c([],t,n.domElement);r.addEventListener("dragstart",(()=>{e.emit(`${l}:changed`,{active:!0},!1)})),r.addEventListener("dragend",(()=>{e.emit(`${l}:changed`,{active:!1},!1)}));let o=new Map;["dragstart","drag","dragend","hoveron","hoveroff"].forEach((e=>{r.addEventListener(e,(t=>{let{object:n}=t,r=o.get(n);r&&r.emit(e,{object3D:n},!1)}))})),Object.assign(this,{camera:t,controls:r,mapObjectToEl:o})},update(){let{controls:e,data:t}=this,{enabled:n}=t;Object.assign(e,{enabled:n})},remove(){this.controls.dispose()},tock(){let{controls:e,data:t,el:n,mapObjectToEl:r}=this,{enabled:o,objects:i}=t;if(o){let t=Array.from(n.sceneEl.querySelectorAll(i)),o=[];r.clear(),t.forEach((e=>{e.isEntity&&e.object3D&&Object.keys(e.object3DMap).forEach((t=>{let n=e.getObject3D(t);o.push(n),r.set(n,e)}))})),e.getObjects().splice(0,void 0,...o)}}})}(AFRAME);
